<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2c3e50">
  <title>Тест для менеджеров</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon-192.png">
  
  <!-- Preload CSS для быстрой загрузки -->
  <link rel="preload" href="styles.css?v=6" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="styles.css?v=6"></noscript>
  
  <style>
    /* Инлайн стили для немедленного отображения */
    :root {
      --primary: #2c3e50;
      --primary-dark: #1a252f;
      --primary-light: #34495e;
      --secondary: #7f8c8d;
      --accent: #3498db;
      --text-primary: #ecf0f1;
      --text-secondary: #bdc3c7;
      --text-light: #95a5a6;
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --bg-card: #2d2d2d;
      --bg-input: #3a3a3a;
      --border: #404040;
      --border-light: #555;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.4);
      --radius: 8px;
      --radius-sm: 6px;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --info: #3498db;
      --btn-bg: #ecf0f1;
      --btn-text: #2c3e50;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      font-size: 16px;
      transition: background-color 0.3s ease;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
    }
    
    /* Минимальные стили для загрузки */
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    h1 {
      color: var(--text-primary);
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 10px;
      line-height: 1.3;
    }
    
    .greeting {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <!-- Preloader -->
  <div id="preloader" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#121212;z-index:9999;display:flex;justify-content:center;align-items:center;">
    <div style="text-align:center;">
      <div style="width:50px;height:50px;border:3px solid #3498db;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px;"></div>
      <p style="color:#ecf0f1;">Загрузка теста...</p>
    </div>
  </div>

  <div class="container" style="display:none;">
    <header class="header">
      <h1>Автоматизированная оценка профессионализма менеджера</h1>
      <p id="userGreeting" class="greeting">Загрузка...</p>
    </header>

    <form id="testForm">
      <!-- Прогресс-бар и индикаторы -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <span class="progress-text" id="progressText">Вопрос 1 из 15</span>
        
        <div class="questions-indicator" id="questionsIndicator">
          <!-- Индикаторы будут добавлены через JS -->
        </div>
      </div>

      <!-- Контейнер для вопросов -->
      <div class="questions-wrapper" id="questionsWrapper">
        <!-- Вопросы здесь... (сохраните ваш HTML с вопросами как было) -->
        <!-- Вопрос 1 -->
        <div class="question" data-index="0">
          <p>1. Как вы обычно распределяете задачи в команде?</p>
          <label><input type="radio" name="q1" value="1" required> Даю общее задание и жду результат</label>
          <label><input type="radio" name="q1" value="2"> Назначаю задачи в зависимости от опыта сотрудников</label>
          <label><input type="radio" name="q1" value="3"> Обсуждаю задачи с командой и согласовываю ответственность</label>
        </div>

        <!-- Вопрос 2 -->
        <div class="question" data-index="1">
          <p>2. Как вы реагируете на срыв сроков проекта?</p>
          <label><input type="radio" name="q2" value="1"> Обвиняю исполнителей</label>
          <label><input type="radio" name="q2" value="2"> Ищу причины и пытаюсь ускорить работу</label>
          <label><input type="radio" name="q2" value="3"> Анализирую риски, корректирую план и согласовываю новые сроки</label>
        </div>

        <!-- Вопрос 3 -->
        <div class="question" data-index="2">
          <p>3. Что вы делаете, если сотрудник постоянно нарушает дедлайны?</p>
          <label><input type="radio" name="q3" value="1"> Игнорирую — авось перестанет</label>
          <label><input type="radio" name="q3" value="2"> Делаю выговор или снижаю премию</label>
          <label><input type="radio" name="q3" value="3"> Провожу личную беседу, выясняю причины и помогаю улучшить процесс</label>
        </div>

        <!-- Вопрос 4 -->
        <div class="question" data-index="3">
          <p>4. Как вы мотивируете команду?</p>
          <label><input type="radio" name="q4" value="1"> Говорю: «Работайте — получите зарплату»</label>
          <label><input type="radio" name="q4" value="2"> Хвалю за хорошие результаты</label>
          <label><input type="radio" name="q4" value="3"> Использую индивидуальный подход: кому-то — признание, кому-то — развитие, кому-то — автономия</label>
        </div>

        <!-- Вопрос 5 -->
        <div class="question" data-index="4">
          <p>5. Как вы строите коммуникацию в команде?</p>
          <label><input type="radio" name="q5" value="1"> Общение только по необходимости</label>
          <label><input type="radio" name="q5" value="2"> Есть регулярные встречи раз в неделю</label>
          <label><input type="radio" name="q5" value="3"> Использую прозрачные каналы (чаты, доски задач), провожу ретроспективы и 1-на-1 встречи</label>
        </div>

        <!-- Вопрос 6 -->
        <div class="question" data-index="5">
          <p>6. Как вы принимаете ключевые решения?</p>
          <label><input type="radio" name="q6" value="1"> Принимаю самостоятельно, быстро</label>
          <label><input type="radio" name="q6" value="2"> Спрашиваю мнение у пары коллег</label>
          <label><input type="radio" name="q6" value="3"> Собираю данные, вовлекаю заинтересованных лиц, взвешиваю риски</label>
        </div>

        <!-- Вопрос 7 -->
        <div class="question" data-index="6">
          <p>7. Что для вас главное в управлении проектом?</p>
          <label><input type="radio" name="q7" value="1"> Чтобы всё было сделано в срок</label>
          <label><input type="radio" name="q7" value="2"> Чтобы не было конфликтов в команде</label>
          <label><input type="radio" name="q7" value="3"> Баланс между сроками, качеством, ресурсами и удовлетворённостью команды</label>
        </div>

        <!-- Вопрос 8 -->
        <div class="question" data-index="7">
          <p>8. Как вы оцениваете эффективность сотрудника?</p>
          <label><input type="radio" name="q8" value="1"> По тому, сколько задач закрыл</label>
          <label><input type="radio" name="q8" value="2"> По отзывам коллег и KPI</label>
          <label><input type="radio" name="q8" value="3"> По достижению целей, развитию навыков и вкладу в команду</label>
        </div>

        <!-- Вопрос 9 -->
        <div class="question" data-index="8">
          <p>9. Что вы делаете при появлении конфликта в команде?</p>
          <label><input type="radio" name="q9" value="1"> Жду, пока разберутся сами</label>
          <label><input type="radio" name="q9" value="2"> Сажаю конфликтующих за стол переговоров</label>
          <label><input type="radio" name="q9" value="3"> Выясняю корневые причины, помогаю наладить коммуникацию и выстроить правила взаимодействия</label>
        </div>

        <!-- Вопрос 10 -->
        <div class="question" data-index="9">
          <p>10. Как вы относитесь к ошибкам сотрудников?</p>
          <label><input type="radio" name="q10" value="1"> Наказываю — чтобы не повторяли</label>
          <label><input type="radio" name="q10" value="2"> Исправляю и прошу быть внимательнее</label>
          <label><input type="radio" name="q10" value="3"> Анализируем ошибку как возможность для обучения всей команды</label>
        </div>

        <!-- Вопрос 11 -->
        <div class="question" data-index="10">
          <p>11. Как вы планируете рабочее время команды?</p>
          <label><input type="radio" name="q11" value="1"> Пусть сами распределяют</label>
          <label><input type="radio" name="q11" value="2"> Ставлю дедлайны и слежу за графиком</label>
          <label><input type="radio" name="q11" value="3"> Использую методы вроде Agile/Scrum: спринты, планирование, оценка задач</label>
        </div>

        <!-- Вопрос 12 -->
        <div class="question" data-index="11">
          <p>12. Что вы делаете для развития команды?</p>
          <label><input type="radio" name="q12" value="1"> Ничего — каждый сам за себя</label>
          <label><input type="radio" name="q12" value="2"> Иногда отправляю на курсы</label>
          <label><input type="radio" name="q12" value="3"> Регулярно обсуждаю цели развития, создаю план роста для каждого</label>
        </div>

        <!-- Вопрос 13 -->
        <div class="question" data-index="12">
          <p>13. Как вы реагируете на изменения в задачах от руководства?</p>
          <label><input type="radio" name="q13" value="1"> Передаю команде без обсуждения</label>
          <label><input type="radio" name="q13" value="2"> Объясняю, что изменилось</label>
          <label><input type="radio" name="q13" value="3"> Анализирую влияние изменений, обсуждаю с командой и адаптирую план</label>
        </div>

        <!-- Вопрос 14 -->
        <div class="question" data-index="13">
          <p>14. Как вы обеспечиваете выполнение задач?</p>
          <label><input type="radio" name="q14" value="1"> Контролирую лично каждый день</label>
          <label><input type="radio" name="q14" value="2"> Спрашиваю раз в несколько дней</label>
          <label><input type="radio" name="q14" value="3"> Использую прозрачные инструменты (Trello, Jira), доверяю, но проверяю ключевые точки</label>
        </div>

        <!-- Вопрос 15 -->
        <div class="question" data-index="14">
          <p>15. Ваша главная роль как менеджера?</p>
          <label><input type="radio" name="q15" value="1"> Контролировать и докладывать наверх</label>
          <label><input type="radio" name="q15" value="2"> Обеспечивать выполнение целей</label>
          <label><input type="radio" name="q15" value="3"> Развивать команду, устранять препятствия и создавать условия для успеха</label>
        </div>
      </div>

      <!-- Навигация -->
      <div class="questions-nav">
        <button type="button" class="nav-btn prev" id="prevBtn" disabled>← Назад</button>
        <button type="button" class="nav-btn next" id="nextBtn">Далее →</button>
        <button type="submit" class="nav-btn submit" id="submitBtn" style="display:none;">Отправить результат</button>
      </div>
    </form>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  
  <script>
    // Firebase конфигурация
    const firebaseConfig = {
      apiKey: "AIzaSyAmTtXSLeksMmRuxlmt19qz60zESOCFGGY",
      authDomain: "manager-test-2b964.firebaseapp.com",
      projectId: "manager-test-2b964",
      storageBucket: "manager-test-2b964.firebasestorage.app",
      messagingSenderId: "769825814408",
      appId: "1:769825814408:web:072ec41246a2d1027b6c3d"
    };
    
    // Инициализация Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Регистрация Service Worker для PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('Service Worker зарегистрирован:', registration);
          })
          .catch(error => {
            console.log('Ошибка регистрации Service Worker:', error);
          });
      });
    }
    
    // Проверка имени пользователя
    const firstName = localStorage.getItem('firstName');
    const lastName = localStorage.getItem('lastName');

    if (firstName && lastName) {
      const greetingElement = document.getElementById('userGreeting');
      if (greetingElement) {
        greetingElement.innerText = `Добро пожаловать, ${firstName} ${lastName}!`;
      }
    } else {
      // Если нет имени, возвращаем на главную
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    }
    
    // Ждем загрузки CSS
    window.addEventListener('load', function() {
      setTimeout(function() {
        document.getElementById('preloader').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
      }, 500);
    });
    
    // Fallback если CSS не загрузился
    setTimeout(function() {
      if (document.getElementById('preloader').style.display !== 'none') {
        document.getElementById('preloader').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
      }
    }, 3000);
  </script>
  
  <!-- Основной скрипт -->
  <script src="main.js?v=3"></script>
  
  <!-- Скрипт для горизонтальной навигации -->
  <script>
    // Основной скрипт навигации
    document.addEventListener('DOMContentLoaded', function() {
      const questionsWrapper = document.getElementById('questionsWrapper');
      const questions = Array.from(document.querySelectorAll('.question'));
      const totalQuestions = questions.length;
      let currentQuestionIndex = 0;

      // Элементы навигации
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submitBtn = document.getElementById('submitBtn');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const questionsIndicator = document.getElementById('questionsIndicator');

      // Создаем индикаторы вопросов
      function createQuestionIndicators() {
        if (!questionsIndicator) return;
        
        questionsIndicator.innerHTML = '';
        for (let i = 0; i < totalQuestions; i++) {
          const dot = document.createElement('div');
          dot.className = 'indicator-dot';
          dot.dataset.index = i;
          if (i === 0) dot.classList.add('active');
          
          dot.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            if (index !== currentQuestionIndex) {
              goToQuestion(index);
            }
          });
          
          questionsIndicator.appendChild(dot);
        }
      }

      // Обновление прогресса
      function updateProgress() {
        if (!progressFill || !progressText) return;
        
        const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
        progressFill.style.width = `${progress}%`;
        progressText.textContent = `Вопрос ${currentQuestionIndex + 1} из ${totalQuestions}`;
        
        // Обновляем индикаторы
        if (questionsIndicator) {
          document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
            dot.classList.remove('active', 'completed');
            if (index === currentQuestionIndex) {
              dot.classList.add('active');
            } else if (index < currentQuestionIndex) {
              dot.classList.add('completed');
            }
          });
        }
      }

      // Переход к вопросу
      function goToQuestion(index) {
        if (index < 0 || index >= totalQuestions) return;
        
        const currentQuestion = questions[currentQuestionIndex];
        const nextQuestion = questions[index];
        
        // Определяем направление анимации
        const isForward = index > currentQuestionIndex;
        const leavingClass = isForward ? 'leaving-left' : 'leaving-right';
        const enteringClass = isForward ? 'next' : 'prev';
        
        // Анимация ухода текущего вопроса
        currentQuestion.classList.remove('active');
        currentQuestion.classList.add(leavingClass);
        
        // Подготовка нового вопроса
        nextQuestion.classList.remove('prev', 'next', 'leaving-left', 'leaving-right');
        nextQuestion.classList.add(enteringClass);
        
        // Задержка для анимации
        setTimeout(() => {
          currentQuestionIndex = index;
          
          // Скрываем старый, показываем новый
          currentQuestion.classList.remove(leavingClass);
          nextQuestion.classList.remove(enteringClass);
          nextQuestion.classList.add('active');
          
          // Обновляем UI
          updateProgress();
          updateNavButtons();
          
          // Плавный скролл к верху
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        }, 300);
      }

      // Обновление кнопок навигации
      function updateNavButtons() {
        if (!prevBtn || !nextBtn || !submitBtn) return;
        
        prevBtn.disabled = currentQuestionIndex === 0;
        
        if (currentQuestionIndex === totalQuestions - 1) {
          nextBtn.style.display = 'none';
          submitBtn.style.display = 'block';
        } else {
          nextBtn.style.display = 'block';
          submitBtn.style.display = 'none';
        }
      }

      // Проверка, ответил ли на вопрос
      function isQuestionAnswered(index) {
        const question = questions[index];
        const inputs = question.querySelectorAll('input[type="radio"]');
        return Array.from(inputs).some(input => input.checked);
      }

      // Инициализация вопросов
      function initQuestions() {
        if (!questionsWrapper || questions.length === 0) return;
        
        // Перемещаем все вопросы в wrapper
        questions.forEach(question => {
          questionsWrapper.appendChild(question);
          question.style.position = 'absolute';
        });
        
        // Показываем первый вопрос
        questions[0].classList.add('active');
        
        // Скрываем остальные
        for (let i = 1; i < questions.length; i++) {
          questions[i].classList.add('next');
        }
        
        createQuestionIndicators();
        updateProgress();
        updateNavButtons();
      }

      // Обработка выбора ответа
      questions.forEach((question, index) => {
        const inputs = question.querySelectorAll('input[type="radio"]');
        inputs.forEach(input => {
          input.addEventListener('change', () => {
            // Анимация выбора
            const label = input.closest('label');
            if (label) {
              label.style.transform = 'translateX(10px)';
              label.style.background = 'rgba(52, 152, 219, 0.1)';
              label.style.borderColor = 'var(--accent)';
              
              setTimeout(() => {
                label.style.transform = '';
                label.style.background = '';
                label.style.borderColor = '';
              }, 300);
            }
            
            // Автоматически переходим к следующему вопросу через 0.5 секунды
            setTimeout(() => {
              if (currentQuestionIndex < totalQuestions - 1) {
                goToQuestion(currentQuestionIndex + 1);
              }
            }, 500);
          });
        });
      });

      // Навигация по кнопкам
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          if (currentQuestionIndex > 0) {
            goToQuestion(currentQuestionIndex - 1);
          }
        });
      }

      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (currentQuestionIndex < totalQuestions - 1) {
            if (isQuestionAnswered(currentQuestionIndex)) {
              goToQuestion(currentQuestionIndex + 1);
            } else {
              // Анимация тряски для незаполненного вопроса
              const currentQuestion = questions[currentQuestionIndex];
              currentQuestion.style.animation = 'shake 0.5s ease';
              setTimeout(() => {
                currentQuestion.style.animation = '';
              }, 500);
              
              alert('Пожалуйста, выберите ответ перед переходом к следующему вопросу.');
            }
          }
        });
      }

      // Инициализация при загрузке
      setTimeout(initQuestions, 100);

      // Добавляем анимацию тряски
      const style = document.createElement('style');
      style.textContent = `
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
          20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
      `;
      document.head.appendChild(style);
    });
  </script>
</body>
</html>
